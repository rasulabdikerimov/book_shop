{% extends 'adminpanel/base.html' %}
{% block title %}Orders ‚Äî Admin{% endblock %}
{% block header %}–ó–∞–∫–∞–∑—ã{% endblock %}
{% block content %}
<div class="panel">
    <!-- –ü–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h3 style="margin: 0 0 10px 0; font-size: 14px; color: #666;">–û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂</h3>
            <p style="margin: 0; font-size: 24px; font-weight: bold; color: #16a34a;">{{ total_sales }} ‚ÇΩ</p>
        </div>
        <button onclick="document.getElementById('sales-modal').style.display='block'" class="btn" style="height: fit-content;">üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ -->
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>–ù–æ–º–µ—Ä</th>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏—è –∫–Ω–∏–≥</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for o in orders %}
                <tr>
                    <td><strong>#{{ o.order_number }}</strong></td>
                    <td>{{ o.user.email }}</td>
                    <td>
                        {% for book in o.book.all %}
                            <span style="display: inline-block; background: #e5e7eb; padding: 4px 8px; border-radius: 4px; margin: 2px; font-size: 12px;">
                                {{ book.title }}
                            </span>
                        {% endfor %}
                    </td>
                    <td><strong>{{ o.total_price }} ‚ÇΩ</strong></td>
                    <td>{{ o.created_at|date:"d.m.Y H:i" }}</td>
                    <td>
                        {% if o.payment_set.first.status == '–í –æ–∂–∏–¥–∞–Ω–∏–∏' %}
                            <span class="badge warning">‚è≥ {{ o.payment_set.first.status }}</span>
                        {% elif o.payment_set.first.status == '–ó–∞–≤–µ—Ä—à–µ–Ω' %}
                            <span class="badge success">‚úÖ {{ o.payment_set.first.status }}</span>
                        {% else %}
                            <span class="badge error">‚ùå {{ o.payment_set.first.status }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'adminpanel:order_detail' o.id %}" class="btn small">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                        <a href="{% url 'adminpanel:order_update_status' o.id %}" class="btn small muted">–°—Ç–∞—Ç—É—Å</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if orders.has_other_pages %}
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
        {% if orders.has_previous %}
            <a href="?page=1" class="btn small">¬´ –ü–µ—Ä–≤–∞—è</a>
            <a href="?page={{ orders.previous_page_number }}" class="btn small">‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% endif %}

        <div style="display: flex; gap: 5px;">
            {% for num in orders.paginator.page_range %}
                {% if orders.number == num %}
                    <span class="btn small" style="background: #0066cc; color: white; cursor: default;">{{ num }}</span>
                {% elif num > orders.number|add:'-3' and num < orders.number|add:'3' %}
                    <a href="?page={{ num }}" class="btn small">{{ num }}</a>
                {% endif %}
            {% endfor %}
        </div>

        {% if orders.has_next %}
            <a href="?page={{ orders.next_page_number }}" class="btn small">–°–ª–µ–¥—É—é—â–∞—è ‚Ä∫</a>
            <a href="?page={{ orders.paginator.num_pages }}" class="btn small">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
        {% endif %}
    </div>
    {% endif %}

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
    <div style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ orders.number }} –∏–∑ {{ orders.paginator.num_pages }} (–≤—Å–µ–≥–æ {{ orders.paginator.count }} –∑–∞–∫–∞–∑–æ–≤)
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
<div id="sales-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4);">
    <div style="background-color: white; margin: 10% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 600px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <span onclick="document.getElementById('sales-modal').style.display='none'" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        
        <h2 style="margin-top: 0;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="padding: 15px; background: #f0f9ff; border-radius: 8px;">
                <p style="margin: 0 0 5px 0; color: #666;">–û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂</p>
                <p style="margin: 0; font-size: 24px; font-weight: bold; color: #16a34a;">{{ total_sales }} ‚ÇΩ</p>
            </div>
            
            <div style="padding: 15px; background: #f0fdf4; border-radius: 8px;">
                <p style="margin: 0 0 5px 0; color: #666;">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
                <p style="margin: 0; font-size: 24px; font-weight: bold; color: #0066cc;">{{ total_orders }}</p>
            </div>
        </div>

        <div style="padding: 15px; background: #fefce8; border-radius: 8px; margin-bottom: 20px;">
            <p style="margin: 0 0 5px 0; color: #666;">–°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞</p>
            <p style="margin: 0; font-size: 20px; font-weight: bold; color: #ca8a04;">{{ average_order }} ‚ÇΩ</p>
        </div>

        <button onclick="document.getElementById('sales-modal').style.display='none'" class="btn" style="width: 100%;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<style>
    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }
    .badge.warning { background-color: #fbbf24; color: #78350f; }
    .badge.success { background-color: #86efac; color: #166534; }
    .badge.error { background-color: #fca5a5; color: #7f1d1d; }
    
    .btn.small {
        padding: 6px 12px;
        font-size: 12px;
        display: inline-block;
    }
</style>

{% endblock %}
