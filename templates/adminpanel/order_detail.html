{% extends 'adminpanel/base.html' %}
{% block title %}Order #{{ order.order_number }} ‚Äî Admin{% endblock %}
{% block header %}–ó–∞–∫–∞–∑ #{{ order.order_number }}{% endblock %}
{% block content %}

<div class="panel">
    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="margin-top: 0; margin-bottom: 15px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</label>
                <p style="margin: 0; font-size: 18px; color: #0066cc;">#{{ order.order_number }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</label>
                <p style="margin: 0;">{{ order.user.email }}<br><small>{{ order.user.username }}</small></p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</label>
                <p style="margin: 0;">{{ order.created_at|date:"d.m.Y H:i" }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞</label>
                <p style="margin: 0; font-size: 18px; color: #16a34a; font-weight: bold;">{{ order.total_price }} ‚ÇΩ</p>
            </div>
        </div>

        {% if payment %}
        <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
        
        <h3 style="margin-top: 0; margin-bottom: 15px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</label>
                <p style="margin: 0;">{{ payment.get_payment_method_display }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞</label>
                <p style="margin: 0;">
                    {% if payment.status == '–í –æ–∂–∏–¥–∞–Ω–∏–∏' %}
                        <span style="background: #fbbf24; color: #78350f; padding: 4px 8px; border-radius: 4px; font-weight: bold;">‚è≥ {{ payment.status }}</span>
                    {% elif payment.status == '–ó–∞–≤–µ—Ä—à–µ–Ω' %}
                        <span style="background: #86efac; color: #166534; padding: 4px 8px; border-radius: 4px; font-weight: bold;">‚úÖ {{ payment.status }}</span>
                    {% else %}
                        <span style="background: #fca5a5; color: #7f1d1d; padding: 4px 8px; border-radius: 4px; font-weight: bold;">‚ùå {{ payment.status }}</span>
                    {% endif %}
                </p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞</label>
                <p style="margin: 0;">{{ payment.amount }} ‚ÇΩ</p>
            </div>
        </div>
        {% endif %}
    </div>

    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="margin-top: 0; margin-bottom: 15px;">–ó–∞–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #ddd;">
                    <th style="text-align: left; padding: 10px;">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</th>
                    <th style="text-align: left; padding: 10px;">–ê–≤—Ç–æ—Ä</th>
                    <th style="text-align: center; padding: 10px;">–¶–µ–Ω–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;">
                        <a href="{% url 'detail' book.slug %}" style="color: #0066cc; text-decoration: none;">{{ book.title }}</a>
                    </td>
                    <td style="padding: 10px;">
                        {% for author in book.authors.all %}
                            {{ author.full_name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    <td style="text-align: center; padding: 10px; font-weight: bold;">{{ book.price }} ‚ÇΩ</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if delivery %}
    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="margin-top: 0; margin-bottom: 15px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <p style="margin: 0;">{{ delivery.delivery_address }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <p style="margin: 0;">{{ delivery.delivery_date|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <p style="margin: 0;">{{ delivery.employee.full_name|default:"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω" }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <p style="margin: 0;">
                    {% if delivery.status == '–í –æ–∂–∏–¥–∞–Ω–∏–∏' %}
                        <span style="background: #fbbf24; color: #78350f; padding: 4px 8px; border-radius: 4px; font-weight: bold;">‚è≥ {{ delivery.status }}</span>
                    {% elif delivery.status == '–í –ø—É—Ç–∏' %}
                        <span style="background: #60a5fa; color: #1e3a8a; padding: 4px 8px; border-radius: 4px; font-weight: bold;">üöö {{ delivery.status }}</span>
                    {% elif delivery.status == '–ó–∞–≤–µ—Ä—à–µ–Ω–∞' %}
                        <span style="background: #86efac; color: #166534; padding: 4px 8px; border-radius: 4px; font-weight: bold;">‚úÖ {{ delivery.status }}</span>
                    {% else %}
                        <span style="background: #fca5a5; color: #7f1d1d; padding: 4px 8px; border-radius: 4px; font-weight: bold;">‚ùå {{ delivery.status }}</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
    {% else %}
    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
        <p style="margin: 0; color: #856404;"><strong>‚ö†Ô∏è –î–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞</strong></p>
    </div>
    {% endif %}

    <div style="display: flex; gap: 10px;">
        <a href="{% url 'adminpanel:order_update_status' order.id %}" class="btn">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞</a>
        {% if delivery %}
            <a href="{% url 'adminpanel:delivery_update_status' delivery.id %}" class="btn">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏</a>
        {% else %}
            <a href="{% url 'adminpanel:delivery_create' order.id %}" class="btn">–°–æ–∑–¥–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É</a>
        {% endif %}
        <a href="{% url 'adminpanel:orders' %}" class="btn muted">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–∫–∞–∑–∞–º</a>
    </div>
</div>

{% endblock %}
