{% extends 'adminpanel/base.html' %}
{% block title %}Order #{{ order.order_number }} — Admin{% endblock %}
{% block header %}Заказ #{{ order.order_number }}{% endblock %}
{% block content %}

<div class="panel">
    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="margin-top: 0; margin-bottom: 15px;">Информация о заказе</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Номер заказа</label>
                <p style="margin: 0; font-size: 18px; color: #0066cc;">#{{ order.order_number }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Пользователь</label>
                <p style="margin: 0;">{{ order.user.email }}<br><small>{{ order.user.username }}</small></p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Дата создания</label>
                <p style="margin: 0;">{{ order.created_at|date:"d.m.Y H:i" }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Сумма заказа</label>
                <p style="margin: 0; font-size: 18px; color: #16a34a; font-weight: bold;">{{ order.total_price }} ₽</p>
            </div>
        </div>

        {% if payment %}
        <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
        
        <h3 style="margin-top: 0; margin-bottom: 15px;">Информация об оплате</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Способ оплаты</label>
                <p style="margin: 0;">{{ payment.get_payment_method_display }}</p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Статус платежа</label>
                <p style="margin: 0;">
                    {% if payment.status == 'В ожидании' %}
                        <span style="background: #fbbf24; color: #78350f; padding: 4px 8px; border-radius: 4px; font-weight: bold;">⏳ {{ payment.status }}</span>
                    {% elif payment.status == 'Завершен' %}
                        <span style="background: #86efac; color: #166534; padding: 4px 8px; border-radius: 4px; font-weight: bold;">✅ {{ payment.status }}</span>
                    {% else %}
                        <span style="background: #fca5a5; color: #7f1d1d; padding: 4px 8px; border-radius: 4px; font-weight: bold;">❌ {{ payment.status }}</span>
                    {% endif %}
                </p>
            </div>
            <div>
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Сумма платежа</label>
                <p style="margin: 0;">{{ payment.amount }} ₽</p>
            </div>
        </div>
        {% endif %}
    </div>

    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="margin-top: 0; margin-bottom: 15px;">Заказанные товары</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #ddd;">
                    <th style="text-align: left; padding: 10px;">Название книги</th>
                    <th style="text-align: left; padding: 10px;">Автор</th>
                    <th style="text-align: center; padding: 10px;">Цена</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;">
                        <a href="{% url 'detail' book.slug %}" style="color: #0066cc; text-decoration: none;">{{ book.title }}</a>
                    </td>
                    <td style="padding: 10px;">
                        {% for author in book.authors.all %}
                            {{ author.full_name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    <td style="text-align: center; padding: 10px; font-weight: bold;">{{ book.price }} ₽</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div style="display: flex; gap: 10px;">
        <a href="{% url 'adminpanel:order_update_status' order.id %}" class="btn">Изменить статус</a>
        <a href="{% url 'adminpanel:orders' %}" class="btn muted">← Назад к заказам</a>
    </div>
</div>

{% endblock %}
