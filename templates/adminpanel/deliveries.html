{% extends 'adminpanel/base.html' %}
{% block title %}Deliveries ‚Äî Admin{% endblock %}
{% block header %}–î–æ—Å—Ç–∞–≤–∫–∏{% endblock %}
{% block content %}
<div class="panel">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="margin-top: 0; margin-bottom: 15px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–æ–∫</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div>
                <p style="margin: 0; color: #666; font-size: 12px;">–í—Å–µ–≥–æ –¥–æ—Å—Ç–∞–≤–æ–∫</p>
                <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #0066cc;">{{ total_deliveries }}</p>
            </div>
            <div>
                <p style="margin: 0; color: #666; font-size: 12px;">–ù–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</p>
                <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #16a34a;">{{ deliveries|length }}</p>
            </div>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–æ—Å—Ç–∞–≤–æ–∫ -->
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</th>
                    <th>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</th>
                    <th>–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</th>
                    <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for d in deliveries %}
                <tr>
                    <td>{{ d.id }}</td>
                    <td>
                        <a href="{% url 'adminpanel:order_detail' d.order.id %}" style="color: #0066cc; text-decoration: none;">
                            #{{ d.order.order_number }}
                        </a>
                    </td>
                    <td>{{ d.delivery_address|truncatewords:5 }}</td>
                    <td>{{ d.delivery_date|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</td>
                    <td>{{ d.employee.full_name|default:"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω" }}</td>
                    <td>
                        {% if d.status == '–í –æ–∂–∏–¥–∞–Ω–∏–∏' %}
                            <span class="badge warning">‚è≥ {{ d.status }}</span>
                        {% elif d.status == '–í –ø—É—Ç–∏' %}
                            <span class="badge info">üöö {{ d.status }}</span>
                        {% elif d.status == '–ó–∞–≤–µ—Ä—à–µ–Ω–∞' %}
                            <span class="badge success">‚úÖ {{ d.status }}</span>
                        {% else %}
                            <span class="badge error">‚ùå {{ d.status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ d.created_at|date:"d.m.Y H:i" }}</td>
                    <td>
                        <a href="{% url 'adminpanel:order_detail' d.order.id %}" class="btn small">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                        <a href="{% url 'adminpanel:delivery_update_status' d.id %}" class="btn small muted">–°—Ç–∞—Ç—É—Å</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if deliveries.has_other_pages %}
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
        {% if deliveries.has_previous %}
            <a href="?page=1" class="btn small">¬´ –ü–µ—Ä–≤–∞—è</a>
            <a href="?page={{ deliveries.previous_page_number }}" class="btn small">‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% endif %}

        <div style="display: flex; gap: 5px;">
            {% for num in deliveries.paginator.page_range %}
                {% if deliveries.number == num %}
                    <span class="btn small" style="background: #0066cc; color: white; cursor: default;">{{ num }}</span>
                {% elif num > deliveries.number|add:'-3' and num < deliveries.number|add:'3' %}
                    <a href="?page={{ num }}" class="btn small">{{ num }}</a>
                {% endif %}
            {% endfor %}
        </div>

        {% if deliveries.has_next %}
            <a href="?page={{ deliveries.next_page_number }}" class="btn small">–°–ª–µ–¥—É—é—â–∞—è ‚Ä∫</a>
            <a href="?page={{ deliveries.paginator.num_pages }}" class="btn small">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
        {% endif %}
    </div>
    {% endif %}

    <div style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ deliveries.number }} –∏–∑ {{ deliveries.paginator.num_pages }} (–≤—Å–µ–≥–æ {{ total_deliveries }} –¥–æ—Å—Ç–∞–≤–æ–∫)
    </div>
</div>

<style>
    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }
    .badge.warning { background-color: #fbbf24; color: #78350f; }
    .badge.info { background-color: #60a5fa; color: #1e3a8a; }
    .badge.success { background-color: #86efac; color: #166534; }
    .badge.error { background-color: #fca5a5; color: #7f1d1d; }
</style>
{% endblock %}
